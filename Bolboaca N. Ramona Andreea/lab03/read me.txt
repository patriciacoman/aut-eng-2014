I couldn't put my mind together and I couldn't solve the problems alone. I asked some of my colleagues and searched the internet for solutions but i didn't find good explanations, just some unclear methods.
However, I read your solutions and I understood pretty much everything. I made some changes in the code but nothing substantial.
Thank you very much for help and for the comments in the code.